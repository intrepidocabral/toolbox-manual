<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>Postgres - Commands - Toobox Manual</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Postgres - Commands";
    var mkdocs_page_input_path = "postgres/postgres_commands.md";
    var mkdocs_page_url = "/postgres/postgres_commands/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Toobox Manual</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../bower/readme/">Bower</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../docker/readme/">Docker</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Git</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../git/git_push_com_chave_ssh/">Git - Push com chave ssh</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../grunt/readme/">Grunt</a>
        
    </li>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../gulp/readme/">Gulp</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Laravel</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../laravel/laravel_commands/">Laravel - Commands</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Mysql</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../mysql/mysql_commands/">Mysql - Commands</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Postgres</span></li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Postgres - Commands</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#login-e-conexao-com-base">Login e conexão com base</a></li>
                
                    <li><a class="toctree-l4" href="#login-usando-socket-peer">Login usando socket (peer)</a></li>
                
                    <li><a class="toctree-l4" href="#logar-usando-usuario-e-senha">Logar usando usuário e senha</a></li>
                
                    <li><a class="toctree-l4" href="#conecta-numa-base-especifica">Conecta numa base específica:</a></li>
                
                    <li><a class="toctree-l4" href="#logout">Logout</a></li>
                
                    <li><a class="toctree-l4" href="#tabelas">Tabelas</a></li>
                
            
                <li class="toctree-l3"><a href="#selecao-de-dados">Seleção de dados</a></li>
                
            
                <li class="toctree-l3"><a href="#criando-um-usuario">Criando um usuário</a></li>
                
            
                <li class="toctree-l3"><a href="#dump">Dump</a></li>
                
            
                <li class="toctree-l3"><a href="#escrita">Escrita</a></li>
                
            
                <li class="toctree-l3"><a href="#gerando-uma-saida-csv">Gerando uma saída CSV</a></li>
                
            
                <li class="toctree-l3"><a href="#gerando-documentacao">Gerando documentação</a></li>
                
            
                <li class="toctree-l3"><a href="#referencias">Referências</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../postgres_autodocs/">Postgres - autodocs</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../rails/readme/">Rails</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Shell Script</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../shell_script/shell_script_commands/">Shell Script - Commands</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../slim/readme/">Slim</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>SSH</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../ssh/ssh_commands/">SSH - Commands</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Sublime</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../sublime/sublime_commands/">Sublime - Commands</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../supervisor/readme/">Supervisor</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>TAR</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../tar/tar_commands/">Tar - Commands</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Vagrant</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../vagrant/vagrant_commands/">Vagrant - Commands</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../wordpress/readme/">Wordpress</a>
        
    </li>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Toobox Manual</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Postgres &raquo;</li>
        
      
    
    <li>Postgres - Commands</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h2 id="login-e-conexao-com-base">Login e conexão com base</h2>
<h4 id="login-usando-socket-peer">Login usando socket (peer)</h4>
<pre><code>$ psql
user=&gt;
</code></pre>

<h4 id="logar-usando-usuario-e-senha">Logar usando usuário e senha</h4>
<p>Para logar usando root e um usuário específico e uma base. Esse método irá exigir senha: </p>
<pre><code># sudo -u NOME-DO-USUARIO psql NOME-DA-BASE
</code></pre>

<p>Para logar com um usuário específico:
  $ psql -h <host> -p <port> -U <username> -W <password> <database></p>
<h4 id="conecta-numa-base-especifica">Conecta numa base específica:</h4>
<p>Depois de logado, é possível usar o comando:</p>
<pre><code>user=&gt; \connect database_name
</code></pre>

<h4 id="logout">Logout</h4>
<pre><code>$ \q
</code></pre>

<h4 id="tabelas">Tabelas</h4>
<ul>
<li>listar todas as bases de dados, depois de logado:</li>
</ul>
<pre><code>    \list ou \l
</code></pre>

<ul>
<li>listar todas as tabelas dentro de uma base, depois de logado:</li>
</ul>
<pre><code>    \dt
</code></pre>

<ul>
<li>listar todas as colunas de uma tabela, depois de conectado a uma base:</li>
</ul>
<pre><code>  \d+ nome-da-coluna;
</code></pre>

<ul>
<li>listar todas as bases de dados, depois de logado:</li>
</ul>
<pre><code>    \list ou \l
</code></pre>

<ul>
<li>listar todas as tabelas dentro de uma base, depois de logado:</li>
</ul>
<pre><code>    =&gt; \dt
</code></pre>

<ul>
<li>listar todas as colunas de uma tabela, depois de conectado a uma base:</li>
</ul>
<pre><code>  =&gt; \d+ nome-da-coluna;
</code></pre>

<h2 id="selecao-de-dados">Seleção de dados</h2>
<p>Depois de logado numa determinada base de dados, fazer uma seleção é muito fácil! Para ver todos os registros de uma tabela, basta digitar: </p>
<pre><code>  =&gt; select * from NOME-TABELA1;
</code></pre>

<p>Para selecionar a partir de alguma(s) determinada(s) coluna(s), você pode tentar:</p>
<pre><code>  =&gt; select nome-coluna1, nome-coluna2 from nome-da-tabela;
</code></pre>

<ul>
<li>Para ordenar: </li>
</ul>
<pre><code>  =&gt; select NOME-COLUNA1, NOME-COLUNA2 from NOME-TABELA1 order by NOME-COLUNA3;
</code></pre>

<p>Para copiar o resultado de uma seleção, use o \copy: </p>
<pre><code>  $ \copy (select * from NOME-COLUNA order by accounts_timtecuser) to '/home/timtec-ifsul/user.csv' with csv;
</code></pre>

<p>Se o objetivo for selecionar a partir de uma referencia pré-conhecida, você pode usar o where:</p>
<pre><code>  select * from NOME-TABELA1 where CAMPO-TABELA1 = 'NUMERO-OU-STRING';
</code></pre>

<p>Ou ainda buscar por um trecho inicial ou final. Aqui estamos buscando todos os nome que começam com a letra p: </p>
<pre><code>  select * from NOME-TABELA1 where NAME LIKE 'p%';
</code></pre>

<p>Seleção por data: </p>
<pre><code>  SELECT * FROM coluna1 WHERE create_timestamp &lt;= '2015-12-14';
</code></pre>

<p>Selecionando multiplos registros: </p>
<pre><code>  SELECT * FROM NOME-TABELA1 WHERE CAMPO-TABELA1 in (1, 2, 5);
</code></pre>

<p>Selecionando com range numerico:</p>
<pre><code>  select id, name from NOME-DA-TABELA where NOME-DO-CAMPO between 1500 AND 2100;
</code></pre>

<h2 id="criando-um-usuario">Criando um usuário</h2>
<pre><code>  # sudo -u postgres createuser -d nome-do-user
</code></pre>

<p>Create a user with a password:</p>
<pre><code>  CREATE USER davide WITH PASSWORD 'jw8s0F4';
</code></pre>

<p>Create a user with a password that is valid until the end of 2004. After one second has ticked in 2005, the password is no longer valid.</p>
<pre><code>   CREATE USER miriam WITH PASSWORD 'jw8s0F4' VALID UNTIL '2005-01-01';
</code></pre>

<p>Create an account where the user can create databases:</p>
<pre><code>  CREATE USER manuel WITH PASSWORD 'jw8s0F4' CREATEDB;
</code></pre>

<h2 id="dump">Dump</h2>
<p>Para fazer dump de uma base inteira para um arquivo .sql vc pode usar o comando:</p>
<pre><code>  pg_dump dbname &gt; outfile
</code></pre>

<p>Para recuperar o dump, user este comando: </p>
<pre><code>  psql dbname &lt; infile
</code></pre>

<h2 id="escrita">Escrita</h2>
<pre><code>  UPDATE nome-da-tabela set campo-da-tabela='dado a ser escrito' where id = '2';
</code></pre>

<h2 id="gerando-uma-saida-csv">Gerando uma saída CSV</h2>
<pre><code>  \copy (select * from agent a inner join usr u on u.id = a.user_id where a.name='') to '~/2016_04_logins_em_branco.csv' with csv
</code></pre>

<p>== Remover registros duplicados ==</p>
<pre><code>  DELETE FROM tablename
  WHERE id IN (SELECT id
              FROM (SELECT id,
                             ROW_NUMBER() OVER (partition BY column1, column2, column3 ORDER BY id) AS rnum
                     FROM tablename) t
              WHERE t.rnum &gt; 1);
</code></pre>

<p>Remover duplicados por linha:</p>
<pre><code>  delete
  from NOME-DA-TABELA
  where id in (
    select
        id
    from (  select 
                id,
                ROW_NUMBER() over (partition by email order by last_login desc) n
            from ifs_ifuser u1 
            where exists (  select 1 from ifs_ifuser 
                            where email = u1.email and id &lt;&gt; u1.id)
        ) t
    where n &gt; 1
  );
</code></pre>

<h2 id="gerando-documentacao">Gerando documentação</h2>
<p>É comum ser necessário gerar documentação do tipo UML ou data dictionary a partir de um schema.sql ou gerar um schema.sql a partir de um modelo de uml estruturado. Para isso você pode usar o [[Postgres - Autodoc]].</p>
<h2 id="referencias">Referências</h2>
<ul>
<li>http://www.postgresql.org/docs/9.1/static/backup-dump.html</li>
</ul>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../postgres_autodocs/" class="btn btn-neutral float-right" title="Postgres - autodocs">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../mysql/mysql_commands/" class="btn btn-neutral" title="Mysql - Commands"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../../mysql/mysql_commands/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../postgres_autodocs/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
