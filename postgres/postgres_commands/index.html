<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="no-js ie6"><![endif]-->
<!--[if IE 7 ]><html class="no-js ie7"><![endif]-->
<!--[if IE 8 ]><html class="no-js ie8"><![endif]-->
<!--[if IE 9 ]><html class="no-js ie9"><![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    
      
        <title>Postgres - Commands - Toobox Manual</title>
      
      
      
      
    
    <meta property="og:url" content="None">
    <meta property="og:title" content="Toobox Manual">
    <meta property="og:image" content="None/../../">
    <meta name="apple-mobile-web-app-title" content="Toobox Manual">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    
    <link rel="shortcut icon" type="image/x-icon" href="../../assets/images/favicon-e565ddfa3b.ico">
    <link rel="icon" type="image/x-icon" href="../../assets/images/favicon-e565ddfa3b.ico">
    <style>
      @font-face {
      	font-family: 'Icon';
      	src: url('../../assets/fonts/icon.eot?52m981');
      	src: url('../../assets/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
      		   url('../../assets/fonts/icon.woff?52m981')
               format('woff'),
      		   url('../../assets/fonts/icon.ttf?52m981')
               format('truetype'),
      		   url('../../assets/fonts/icon.svg?52m981#icon')
               format('svg');
      	font-weight: normal;
      	font-style: normal;
      }
    </style>
    <link rel="stylesheet" href="../../assets/stylesheets/application-a422ff04cc.css">
    
    
      
      
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu+Mono">
      <style>
        body, input {
          font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
        }
        pre, code {
          font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
        }
      </style>
    
    
    <script src="../../assets/javascripts/modernizr-4ab42b99fd.js"></script>
    
  </head>
  
  
  
  <body class=" ">
    
    <div class="backdrop">
      <div class="backdrop-paper"></div>
    </div>
    <input class="toggle" type="checkbox" id="toggle-drawer">
    <input class="toggle" type="checkbox" id="toggle-search">
    <label class="toggle-button overlay" for="toggle-drawer"></label>
    <header class="header">
      <nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        
          <span class="path">
            
              
                Postgres <i class="icon icon-link"></i>
              
            
          </span>
        
        Postgres - Commands
      </div>
    </div>
    
    
    <div class="button button-search" role="button" aria-label="Search">
      <label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
    </div>
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
    </header>
    <main class="main">
      
      <div class="drawer">
        <nav aria-label="Navigation">
  
  <a href="/" class="project">
    <div class="banner">
      
      <div class="name">
        <strong>
          Toobox Manual
          <span class="version">
            
          </span>
        </strong>
        
      </div>
    </div>
  </a>
  <div class="scrollable">
    <div class="wrapper">
      
      <div class="toc">
        <ul>
          
            
  <li>
    <a class="" title="Home" href="../..">
      Home
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Bower" href="../../bower/readme/">
      Bower
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Docker" href="../../docker/readme/">
      Docker
    </a>
    
  </li>

          
            
  <li>
    <span class="section">Git</span>
    <ul>
      
        
  <li>
    <a class="" title="Git - Push com chave ssh" href="../../git/git_push_com_chave_ssh/">
      Git - Push com chave ssh
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <a class="" title="Grunt" href="../../grunt/readme/">
      Grunt
    </a>
    
  </li>

          
            
  <li>
    <a class="" title="Gulp" href="../../gulp/readme/">
      Gulp
    </a>
    
  </li>

          
            
  <li>
    <span class="section">Laravel</span>
    <ul>
      
        
  <li>
    <a class="" title="Laravel - Commands" href="../../laravel/laravel_commands/">
      Laravel - Commands
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Mysql</span>
    <ul>
      
        
  <li>
    <a class="" title="Mysql - Commands" href="../../mysql/mysql_commands/">
      Mysql - Commands
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Postgres</span>
    <ul>
      
        
  <li>
    <a class="current" title="Postgres - Commands" href="./">
      Postgres - Commands
    </a>
    
      
      
        <ul>
          
            <li class="anchor">
              <a title="Login e conexão com base" href="#login-e-conexao-com-base">
                Login e conexão com base
              </a>
            </li>
          
            <li class="anchor">
              <a title="Seleção de dados" href="#selecao-de-dados">
                Seleção de dados
              </a>
            </li>
          
            <li class="anchor">
              <a title="Criando um usuário" href="#criando-um-usuario">
                Criando um usuário
              </a>
            </li>
          
            <li class="anchor">
              <a title="Dump" href="#dump">
                Dump
              </a>
            </li>
          
            <li class="anchor">
              <a title="Escrita" href="#escrita">
                Escrita
              </a>
            </li>
          
            <li class="anchor">
              <a title="Gerando uma saída CSV" href="#gerando-uma-saida-csv">
                Gerando uma saída CSV
              </a>
            </li>
          
            <li class="anchor">
              <a title="Gerando documentação" href="#gerando-documentacao">
                Gerando documentação
              </a>
            </li>
          
            <li class="anchor">
              <a title="Referências" href="#referencias">
                Referências
              </a>
            </li>
          
        </ul>
      
    
  </li>

      
        
  <li>
    <a class="" title="Postgres - autodocs" href="../postgres_autodocs/">
      Postgres - autodocs
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <a class="" title="Rails" href="../../rails/readme/">
      Rails
    </a>
    
  </li>

          
            
  <li>
    <span class="section">Shell Script</span>
    <ul>
      
        
  <li>
    <a class="" title="Shell Script - Commands" href="../../shell_script/shell_script_commands/">
      Shell Script - Commands
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <a class="" title="Slim" href="../../slim/readme/">
      Slim
    </a>
    
  </li>

          
            
  <li>
    <span class="section">SSH</span>
    <ul>
      
        
  <li>
    <a class="" title="SSH - Commands" href="../../ssh/ssh_commands/">
      SSH - Commands
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Sublime</span>
    <ul>
      
        
  <li>
    <a class="" title="Sublime - Commands" href="../../sublime/sublime_commands/">
      Sublime - Commands
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <a class="" title="Supervisor" href="../../supervisor/readme/">
      Supervisor
    </a>
    
  </li>

          
            
  <li>
    <span class="section">TAR</span>
    <ul>
      
        
  <li>
    <a class="" title="Tar - Commands" href="../../tar/tar_commands/">
      Tar - Commands
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Vagrant</span>
    <ul>
      
        
  <li>
    <a class="" title="Vagrant - Commands" href="../../vagrant/vagrant_commands/">
      Vagrant - Commands
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <a class="" title="Wordpress" href="../../wordpress/readme/">
      Wordpress
    </a>
    
  </li>

          
        </ul>
        
      </div>
    </div>
  </div>
</nav>
      </div>
      <article class="article">
        <div class="wrapper">
          
            <h1>Postgres - Commands</h1>
          
          <h2 id="login-e-conexao-com-base">Login e conexão com base</h2>
<h4 id="login-usando-socket-peer">Login usando socket (peer)</h4>
<pre><code>$ psql
user=&gt;
</code></pre>

<h4 id="logar-usando-usuario-e-senha">Logar usando usuário e senha</h4>
<p>Para logar usando root e um usuário específico e uma base. Esse método irá exigir senha: </p>
<pre><code># sudo -u NOME-DO-USUARIO psql NOME-DA-BASE
</code></pre>

<p>Para logar com um usuário específico:
  $ psql -h <host> -p <port> -U <username> -W <password> <database></p>
<h4 id="conecta-numa-base-especifica">Conecta numa base específica:</h4>
<p>Depois de logado, é possível usar o comando:</p>
<pre><code>user=&gt; \connect database_name
</code></pre>

<h4 id="logout">Logout</h4>
<pre><code>$ \q
</code></pre>

<h4 id="tabelas">Tabelas</h4>
<ul>
<li>listar todas as bases de dados, depois de logado:</li>
</ul>
<pre><code>    \list ou \l
</code></pre>

<ul>
<li>listar todas as tabelas dentro de uma base, depois de logado:</li>
</ul>
<pre><code>    \dt
</code></pre>

<ul>
<li>listar todas as colunas de uma tabela, depois de conectado a uma base:</li>
</ul>
<pre><code>  \d+ nome-da-coluna;
</code></pre>

<ul>
<li>listar todas as bases de dados, depois de logado:</li>
</ul>
<pre><code>    \list ou \l
</code></pre>

<ul>
<li>listar todas as tabelas dentro de uma base, depois de logado:</li>
</ul>
<pre><code>    =&gt; \dt
</code></pre>

<ul>
<li>listar todas as colunas de uma tabela, depois de conectado a uma base:</li>
</ul>
<pre><code>  =&gt; \d+ nome-da-coluna;
</code></pre>

<h2 id="selecao-de-dados">Seleção de dados</h2>
<p>Depois de logado numa determinada base de dados, fazer uma seleção é muito fácil! Para ver todos os registros de uma tabela, basta digitar: </p>
<pre><code>  =&gt; select * from NOME-TABELA1;
</code></pre>

<p>Para selecionar a partir de alguma(s) determinada(s) coluna(s), você pode tentar:</p>
<pre><code>  =&gt; select nome-coluna1, nome-coluna2 from nome-da-tabela;
</code></pre>

<ul>
<li>Para ordenar: </li>
</ul>
<pre><code>  =&gt; select NOME-COLUNA1, NOME-COLUNA2 from NOME-TABELA1 order by NOME-COLUNA3;
</code></pre>

<p>Para copiar o resultado de uma seleção, use o \copy: </p>
<pre><code>  $ \copy (select * from NOME-COLUNA order by accounts_timtecuser) to '/home/timtec-ifsul/user.csv' with csv;
</code></pre>

<p>Se o objetivo for selecionar a partir de uma referencia pré-conhecida, você pode usar o where:</p>
<pre><code>  select * from NOME-TABELA1 where CAMPO-TABELA1 = 'NUMERO-OU-STRING';
</code></pre>

<p>Ou ainda buscar por um trecho inicial ou final. Aqui estamos buscando todos os nome que começam com a letra p: </p>
<pre><code>  select * from NOME-TABELA1 where NAME LIKE 'p%';
</code></pre>

<p>Seleção por data: </p>
<pre><code>  SELECT * FROM coluna1 WHERE create_timestamp &lt;= '2015-12-14';
</code></pre>

<p>Selecionando multiplos registros: </p>
<pre><code>  SELECT * FROM NOME-TABELA1 WHERE CAMPO-TABELA1 in (1, 2, 5);
</code></pre>

<p>Selecionando com range numerico:</p>
<pre><code>  select id, name from NOME-DA-TABELA where NOME-DO-CAMPO between 1500 AND 2100;
</code></pre>

<h2 id="criando-um-usuario">Criando um usuário</h2>
<pre><code>  # sudo -u postgres createuser -d nome-do-user
</code></pre>

<p>Create a user with a password:</p>
<pre><code>  CREATE USER davide WITH PASSWORD 'jw8s0F4';
</code></pre>

<p>Create a user with a password that is valid until the end of 2004. After one second has ticked in 2005, the password is no longer valid.</p>
<pre><code>   CREATE USER miriam WITH PASSWORD 'jw8s0F4' VALID UNTIL '2005-01-01';
</code></pre>

<p>Create an account where the user can create databases:</p>
<pre><code>  CREATE USER manuel WITH PASSWORD 'jw8s0F4' CREATEDB;
</code></pre>

<h2 id="dump">Dump</h2>
<p>Para fazer dump de uma base inteira para um arquivo .sql vc pode usar o comando:</p>
<pre><code>  pg_dump dbname &gt; outfile
</code></pre>

<p>Para recuperar o dump, user este comando: </p>
<pre><code>  psql dbname &lt; infile
</code></pre>

<h2 id="escrita">Escrita</h2>
<pre><code>  UPDATE nome-da-tabela set campo-da-tabela='dado a ser escrito' where id = '2';
</code></pre>

<h2 id="gerando-uma-saida-csv">Gerando uma saída CSV</h2>
<pre><code>  \copy (select * from agent a inner join usr u on u.id = a.user_id where a.name='') to '~/2016_04_logins_em_branco.csv' with csv
</code></pre>

<p>== Remover registros duplicados ==</p>
<pre><code>  DELETE FROM tablename
  WHERE id IN (SELECT id
              FROM (SELECT id,
                             ROW_NUMBER() OVER (partition BY column1, column2, column3 ORDER BY id) AS rnum
                     FROM tablename) t
              WHERE t.rnum &gt; 1);
</code></pre>

<p>Remover duplicados por linha:</p>
<pre><code>  delete
  from NOME-DA-TABELA
  where id in (
    select
        id
    from (  select 
                id,
                ROW_NUMBER() over (partition by email order by last_login desc) n
            from ifs_ifuser u1 
            where exists (  select 1 from ifs_ifuser 
                            where email = u1.email and id &lt;&gt; u1.id)
        ) t
    where n &gt; 1
  );
</code></pre>

<h2 id="gerando-documentacao">Gerando documentação</h2>
<p>É comum ser necessário gerar documentação do tipo UML ou data dictionary a partir de um schema.sql ou gerar um schema.sql a partir de um modelo de uml estruturado. Para isso você pode usar o [[Postgres - Autodoc]].</p>
<h2 id="referencias">Referências</h2>
<ul>
<li>http://www.postgresql.org/docs/9.1/static/backup-dump.html</li>
</ul>
          <aside class="copyright" role="note">
            
            Documentation built with
            <a href="http://www.mkdocs.org" target="_blank">MkDocs</a>
            using the
            <a href="http://squidfunk.github.io/mkdocs-material/" target="_blank">
              Material
            </a>
            theme.
          </aside>
          
            <footer class="footer">
              
  <nav class="pagination" aria-label="Footer">
    <div class="previous">
      
        <a href="../../mysql/mysql_commands/" title="Mysql - Commands">
          <span class="direction">
            Previous
          </span>
          <div class="page">
            <div class="button button-previous" role="button" aria-label="Previous">
              <i class="icon icon-back"></i>
            </div>
            <div class="stretch">
              <div class="title">
                Mysql - Commands
              </div>
            </div>
          </div>
        </a>
      
    </div>
    <div class="next">
      
        <a href="../postgres_autodocs/" title="Postgres - autodocs">
          <span class="direction">
            Next
          </span>
          <div class="page">
            <div class="stretch">
              <div class="title">
                Postgres - autodocs
              </div>
            </div>
            <div class="button button-next" role="button" aria-label="Next">
              <i class="icon icon-forward"></i>
            </div>
          </div>
        </a>
      
    </div>
  </nav>

            </footer>
          
        </div>
      </article>
      <div class="results" role="status" aria-live="polite">
        <div class="scrollable">
          <div class="wrapper">
            <div class="meta"></div>
            <div class="list"></div>
          </div>
        </div>
      </div>
    </main>
    <script>
      var base_url = '../..';
      var repo_id  = '';
    </script>
    <script src="../../assets/javascripts/application-997097ee0c.js"></script>
    
    
  </body>
</html>